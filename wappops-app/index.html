<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UBH Operaciones</title>
  
  <!-- PWA Theme Color -->
  <meta name="theme-color" content="#ffffff" />
  
  <!-- PWA Icons -->
  <link rel="icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/pwa-512x512.png" />
  
  <!-- Critical CSS - preload for offline priority -->
  <link rel="preload" href="/src/index.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
  <noscript><link rel="stylesheet" href="/src/index.css"></noscript>
  <link rel="stylesheet" href="/src/index.css" />

  <script type="module" src="/src/components/app/ubh-shell"></script>
  
  <!-- Mobile Navigation Debug (only in development) -->
  <script>
    if (location.hostname === 'localhost' || location.hostname.includes('vite.')) {
      const script = document.createElement('script');
      script.src = '/mobile-nav-debug.js';
      document.head.appendChild(script);
    }
  </script>
</head>

<style>
  html.theme-dark {
    background-color: hsl(240 5.3% 26.1%);
    color: white;
  }

  #startup {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    gap: 1rem;
    justify-content: center;
    align-items: center;
    /* background-color: #fff; */
  }

  #startup img {
    width: 200px;
    height: 200px;
  }

  /* Fallback for logo when offline */
  #startup img[src*="pwa-512x512.png"] {
    /* Ensure the logo image is cached and visible offline */
    background: url('/pwa-512x512.png') no-repeat center center;
    background-size: contain;
  }

  /* Hide broken image icon if image fails to load */
  #startup img:not([src]), #startup img[src=""] {
    opacity: 0;
  }
</style>

<body>
  <div id="startup">
    <img src="/pwa-512x512.png" alt="UBH Logo" onerror="this.style.display='none'" />
    <span>UBH Operaciones</span>
    <progress id="progress-bar" aria-label="Cargando aplicación"></progress>
  </div>
  <ubh-shell style="display: none;"></ubh-shell>

  <script>
    const html = document.documentElement;
    html.classList.remove("theme-light", "theme-dark");

    const lsConfig = localStorage.getItem("wappops-client-config");
    if (lsConfig) {
      try {
        const config = JSON.parse(lsConfig);
        const theme = config?.preferences?.theme || "light";
        html.classList.add(`theme-${theme}`);
      } catch (_error) {
        // Ignorar. Se adpotarán valores por defecto.
      }
    }

    addEventListener("DOMContentLoaded", (event) => {
      const startup = document.getElementById("startup");
      const shell = document.querySelector("ubh-shell");
      html.classList.remove("theme-light", "theme-dark");

      setTimeout(() => {
        startup.style.display = "none";
        shell.style.display = "block";
      }, 2000);
    })
  </script>
</body>

</html>